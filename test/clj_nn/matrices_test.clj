(ns clj-nn.matrices-test
  (:use clojure.test
        clj-nn.matrices))

(def v [[1 2 3] [4 5 6] [7 8 9]])
(def r [[1 2 3] [4 5 6]])
(def c [[1 2] [3 4] [5 6]])
(def o [[1 1] [1 1]])

(deftest auxiliary
  (is (= (unpack [[]]) []))
  (is (= (unpack [[[] []]]) [[] []])))

(deftest accessing-elements
  (is (= (elem v 0 0) 1))
  (is (= (elem v 0 1) 2))
  (is (= (elem v 0 2) 3))
  (is (= (elem v 1 0) 4))
  (is (= (elem v 1 1) 5))
  (is (= (elem v 2 2) 9))

  (is (= (elem r 0 0) 1))
  (is (= (elem r 0 1) 2))
  (is (= (elem r 1 2) 6))
  (is (= (elem c 0 0) 1))

  (is (= (elem c 1 0) 3))
  (is (= (elem c 2 1) 6))

  ;-----------------------------

  (is (= (row v 0) [[1 2 3]]))
  (is (= (row v 1) [[4 5 6]]))
  (is (= (row v 2) [[7 8 9]]))

  (is (= (row r 0) [[1 2 3]]))
  (is (= (row r 1) [[4 5 6]]))

  (is (= (row c 0) [[1 2]]))
  (is (= (row c 1) [[3 4]]))
  (is (= (row c 2) [[5 6]]))

  (is (= (col v 0) [[1 4 7]]))
  (is (= (col v 1) [[2 5 8]]))
  (is (= (col v 2) [[3 6 9]]))

  (is (= (col r 0) [[1 4]]))
  (is (= (col r 1) [[2 5]]))
  (is (= (col r 2) [[3 6]]))

  (is (= (col c 0) [[1 3 5]]))
  (is (= (col c 1) [[2 4 6]]))

  ;-----------------------------

  (is (= (rowc v) 3))
  (is (= (colc v) 3))

  (is (= (rowc r) 2))
  (is (= (colc r) 3))

  (is (= (rowc c) 3))
  (is (= (colc c) 2))

  ;-----------------------------

  (is (= (rows v 0 1) [[1 2 3] [4 5 6]]))
  (is (= (rows v 1 2) [[4 5 6] [7 8 9]]))

  (is (= (rows r 0 1) [[1 2 3] [4 5 6]]))
  (is (= (rows r 0 0) [[1 2 3]]))

  (is (= (rows c 0 1) [[1 2] [3 4]]))
  (is (= (rows c 1 2) [[3 4] [5 6]]))

  ;-----------------------------

  (is (= (cols v 0 1) [[1 4 7] [2 5 8]]))
  (is (= (cols v 1 2) [[2 5 8] [3 6 9]]))

  (is (= (cols r 0 1) [[1 4] [2 5]]))
  (is (= (cols r 1 2) [[2 5] [3 6]]))

  (is (= (cols c 0 0) [[1 3 5]]))
  (is (= (cols c 0 1) [[1 3 5] [2 4 6]]))

  ;-----------------------------

  (is (= (rows-from v 1) [[4 5 6] [7 8 9]]))
  (is (= (rows-from v 2) [[7 8 9]]))

  (is (= (rows-to v 0) [[1 2 3]]))
  (is (= (rows-to v 1) [[1 2 3] [4 5 6]]))

  (is (= (cols-from v 1) [[2 5 8] [3 6 9]]))
  (is (= (cols-from v 2) [[3 6 9]]))

  (is (= (cols-to v 0) [[1 4 7]]))
  (is (= (cols-to v 1) [[1 4 7] [2 5 8]])))

(deftest matrix-operations
  (is (= (add-under v [[10 11 12]]) [[1 2 3] [4 5 6] [7 8 9] [10 11 12]]))
  (is (= (add-under v [[10 11 12] [13 14 15]]) [[1 2 3] [4 5 6] [7 8 9] [10 11 12] [13 14 15]]))

  (is (= (add-besides v [[10] [11] [12]]) [[1 2 3 10] [4 5 6 11] [7 8 9 12]]))
  (is (= (add-besides v [[10 11] [12 13] [14 15]]) [[1 2 3 10 11] [4 5 6 12 13] [7 8 9 14 15]]))

  ;-----------------------------

  (is (= (emap inc v) [[2 3 4] [5 6 7] [8 9 10]]))
  (is (= (emap + v v) [[2 4 6] [8 10 12] [14 16 18]]))
  (is (= (emap + v v v) [[3 6 9] [12 15 18] [21 24 27]]))
  (is (= (emap + v v v v) [[4 8 12] [16 20 24] [28 32 36]]))

  ;-----------------------------

  (is (= (rowfold + c) [[3] [7] [11]]))
  (is (= (rowfold + 1 c) [[4] [8] [12]]))

  (is (= (colfold + c) [[9 12]]))
  (is (= (colfold + 1 c) [[10 13]]))

  (is (= (fold + c) 21))
  (is (= (fold + 1 c) 22))

  ;-----------------------------

  (is (= (rowsum v) [[6] [15] [24]]))
  (is (= (colsum v) [[12 15 18]]))
  (is (= (sum v) 45))

  ;-----------------------------

  (is (= (nadd 1 v) [[2 3 4] [5 6 7] [8 9 10]]))
  (is (= (nsub 1 v) [[0 1 2] [3 4 5] [6 7 8]]))
  (is (= (nmul 2 v) [[2 4 6] [8 10 12] [14 16 18]]))
  (is (= (ndiv 2 v) [[1/2 2/2 3/2] [4/2 5/2 6/2] [7/2 8/2 9/2]]))
  (is (= (npow 2 v) [[1.0 4.0 9.0] [16.0 25.0 36.0] [49.0 64.0 81.0]]))

  ;-----------------------------

  (is (= (zeros 2 3) [[0 0 0] [0 0 0]]))
  (is (= (ones 3 2) [[1 1] [1 1] [1 1]]))
  (is (= (ident 3 2) [[1 0] [0 1] [0 0]]))

  ;-----------------------------

  (is (= (trans v) [[1 4 7] [2 5 8] [3 6 9]]))
  (is (= (trans (trans v)) v))

  (is (= (prod r c) [[22 28] [49 64]]))
  (is (= (prod c r) [[9 12 15] [19 26 33] [29 40 51]]))

  ;-----------------------------

  (is (= (eadd o) [[1 1] [1 1]]))
  (is (= (eadd o o) [[2 2] [2 2]]))
  (is (= (eadd o o o) [[3 3] [3 3]]))
  (is (= (eadd o o o o) [[4 4] [4 4]]))

  (is (= (esub o) [[-1 -1] [-1 -1]]))
  (is (= (esub o o) [[0 0] [0 0]]))
  (is (= (esub o o o) [[-1 -1] [-1 -1]]))
  (is (= (esub o o o o) [[-2 -2] [-2 -2]]))

  (is (= (emul [[2 2] [2 2]] [[3 3] [3 3]]) [[6 6] [6 6]]))

  (is (= (ediv [[2 2] [2 2]] [[3 3] [3 3]]) [[2/3 2/3] [2/3 2/3]])))
